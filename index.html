<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CycloBot</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: #fff;
      color: #111;
      font-family: 'Courier New', Courier, monospace;
      font-size: 13px;
      min-height: 100vh;
    }

    header {
      border-bottom: 2px solid #111;
      padding: .6rem 1.5rem;
      display: flex;
      align-items: baseline;
      gap: 1.5rem;
    }
    header h1 { font-size: 15px; font-weight: bold; letter-spacing: .05em; }
    header span { font-size: 12px; color: #555; }

    .container { max-width: 820px; margin: 0 auto; padding: 1.25rem 1.5rem; }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 0;
      border-bottom: 1px solid #aaa;
      margin-bottom: 1.5rem;
    }
    .tab-btn {
      background: none;
      border: 1px solid transparent;
      border-bottom: none;
      color: #555;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
      padding: .35rem .9rem;
      margin-bottom: -1px;
    }
    .tab-btn:hover { color: #111; }
    .tab-btn.active {
      color: #111;
      border-color: #aaa;
      border-bottom-color: #fff;
      background: #fff;
    }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* Section heading */
    .section-title {
      font-size: 13px;
      font-weight: bold;
      margin-bottom: .2rem;
    }
    .section-desc {
      font-size: 11px;
      color: #666;
      margin-bottom: 1rem;
    }

    /* Form grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: .5rem .75rem;
      margin-bottom: .9rem;
    }
    .field { display: flex; flex-direction: column; gap: .2rem; }
    .field label { font-size: 11px; color: #444; }
    .field input {
      background: #fff;
      border: 1px solid #999;
      color: #111;
      font-family: inherit;
      font-size: 12px;
      padding: .3rem .4rem;
    }
    .field input:focus { outline: 1px solid #111; }
    .field input.optional { border-style: dashed; }
    .field .hint { font-size: 10px; color: #777; }

    button.submit {
      background: #111;
      border: 1px solid #111;
      color: #fff;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
      padding: .35rem 1.1rem;
    }
    button.submit:disabled { opacity: .4; cursor: not-allowed; }
    button.submit:hover:not(:disabled) { background: #333; }

    /* Status */
    .status {
      font-size: 11px;
      margin-top: .5rem;
      min-height: 1rem;
    }
    .status.loading { color: #555; }
    .status.error   { color: #b00; white-space: pre-wrap; font-size: 10px; }
    .status.success { color: #080; }

    /* Result */
    .result { display: none; margin-top: 1rem; }
    .result.visible { display: block; }
    .result img {
      max-width: 100%;
      display: block;
      border: 1px solid #ccc;
      margin-bottom: .5rem;
    }
    .result .links { display: flex; gap: 1rem; }
    .result .links a {
      color: #111;
      font-size: 11px;
      text-decoration: underline;
    }

    hr { border: none; border-top: 1px solid #ddd; margin: 1.25rem 0; }
  </style>
</head>
<body>

<header>
  <h1>CYCLOBOT</h1>
  <span>Satellite Imagery &amp; Model Diagnostics / Deelan Jariwala</span>
</header>

<div class="container">

  <div class="tabs">
    <button class="tab-btn active" data-tab="plot">GOES / Himawari</button>
    <button class="tab-btn"       data-tab="mcfetch">McIDAS</button>
    <button class="tab-btn"       data-tab="hafs">HAFS</button>
  </div>

  <!-- ── PLOT ──────────────────────────────────────────────── -->
  <div class="tab-panel active" id="tab-plot">
    <div class="section-title">Satellite IR / Water Vapor</div>
    <div class="section-desc">GOES-R (16/18/19) and Himawari (8/9) full-disk channels via AWS.</div>
    <div class="grid">
      <div class="field">
        <label>SATELLITE</label>
        <input id="plot-satellite" type="text" placeholder="16, 18, H9" />
        <span class="hint">16 18 19 H8 H9</span>
      </div>
      <div class="field">
        <label>DATE</label>
        <input id="plot-date" type="text" placeholder="MM/DD/YYYY" />
      </div>
      <div class="field">
        <label>TIME (UTC)</label>
        <input id="plot-time" type="text" placeholder="1800" maxlength="4" />
      </div>
      <div class="field">
        <label>LAT</label>
        <input id="plot-lat" type="text" placeholder="25.0" />
      </div>
      <div class="field">
        <label>LON</label>
        <input id="plot-lon" type="text" placeholder="-80.0" />
      </div>
      <div class="field">
        <label>BAND</label>
        <input id="plot-band" type="text" placeholder="13" />
        <span class="hint">channel number</span>
      </div>
      <div class="field">
        <label>COLORMAP</label>
        <input id="plot-cmap" type="text" placeholder="irg" class="optional" />
        <span class="hint">optional</span>
      </div>
      <div class="field">
        <label>ZOOM</label>
        <input id="plot-zoom" type="text" placeholder="2" class="optional" />
        <span class="hint">optional</span>
      </div>
    </div>
    <button class="submit" onclick="runPlot()">run</button>
    <div class="status" id="plot-status"></div>
    <div class="result" id="plot-result">
      <img id="plot-img" src="" alt="" />
      <div class="links">
        <a id="plot-img-link" href="#" target="_blank">open image</a>
        <a id="plot-nc-link"  href="#" target="_blank">download .nc</a>
      </div>
    </div>
  </div>

  <!-- ── MCFETCH ────────────────────────────────────────────── -->
  <div class="tab-panel" id="tab-mcfetch">
    <div class="section-title">McIDAS Satellite Fetch</div>
    <div class="section-desc">Older geostationary archive via SSEC McIDAS server. Covers GOES 1–15, GMS, MTSAT, early Himawari.</div>
    <div class="grid">
      <div class="field">
        <label>SATELLITE</label>
        <input id="mc-satellite" type="text" placeholder="G8, G12, 8" />
      </div>
      <div class="field">
        <label>DATE</label>
        <input id="mc-date" type="text" placeholder="MM/DD/YYYY" />
      </div>
      <div class="field">
        <label>TIME (UTC)</label>
        <input id="mc-time" type="text" placeholder="1800" maxlength="4" />
      </div>
      <div class="field">
        <label>LAT</label>
        <input id="mc-lat" type="text" placeholder="25.0" />
      </div>
      <div class="field">
        <label>LON</label>
        <input id="mc-lon" type="text" placeholder="-80.0" />
      </div>
      <div class="field">
        <label>BAND</label>
        <input id="mc-band" type="text" placeholder="4" />
        <span class="hint">3=WV  4=IR</span>
      </div>
      <div class="field">
        <label>COLORMAP</label>
        <input id="mc-cmap" type="text" placeholder="irg" class="optional" />
        <span class="hint">optional</span>
      </div>
      <div class="field">
        <label>ZOOM (max 2)</label>
        <input id="mc-zoom" type="text" placeholder="2" class="optional" />
        <span class="hint">optional</span>
      </div>
    </div>
    <button class="submit" onclick="runMcfetch()">run</button>
    <div class="status" id="mc-status"></div>
    <div class="result" id="mc-result">
      <img id="mc-img" src="" alt="" />
      <div class="links">
        <a id="mc-img-link" href="#" target="_blank">open image</a>
        <a id="mc-nc-link"  href="#" target="_blank">download .nc</a>
      </div>
    </div>
  </div>

  <!-- ── HAFS ──────────────────────────────────────────────── -->
  <div class="tab-panel" id="tab-hafs">
    <div class="section-title">HAFS Model Diagnostics</div>
    <div class="section-desc">Hurricane Analysis and Forecast System (HAFS-A/B) real-time output.</div>
    <div class="grid">
      <div class="field">
        <label>STORM</label>
        <input id="hafs-storm" type="text" placeholder="09l" />
        <span class="hint">NNX format</span>
      </div>
      <div class="field">
        <label>INIT DATE</label>
        <input id="hafs-date" type="text" placeholder="MM/DD/YYYY" />
      </div>
      <div class="field">
        <label>INIT HOUR (UTC)</label>
        <input id="hafs-init" type="text" placeholder="12" maxlength="2" />
        <span class="hint">00 06 12 18</span>
      </div>
      <div class="field">
        <label>FCST HOUR</label>
        <input id="hafs-fhour" type="text" placeholder="024" maxlength="3" />
        <span class="hint">e.g. 024 048</span>
      </div>
      <div class="field">
        <label>VARIABLE</label>
        <input id="hafs-var" type="text" placeholder="diseq" />
        <span class="hint">temp wind rh vort pwat cape sst slp shear…</span>
      </div>
      <div class="field">
        <label>LEVEL (hPa)</label>
        <input id="hafs-level" type="text" placeholder="850" class="optional" />
        <span class="hint">optional</span>
      </div>
      <div class="field">
        <label>MODEL</label>
        <input id="hafs-model" type="text" placeholder="a" maxlength="1" class="optional" />
        <span class="hint">a or b</span>
      </div>
      <div class="field">
        <label>DOMAIN</label>
        <input id="hafs-domain" type="text" placeholder="storm" class="optional" />
        <span class="hint">storm or synoptic</span>
      </div>
    </div>
    <button class="submit" onclick="runHafs()">run</button>
    <div class="status" id="hafs-status"></div>
    <div class="result" id="hafs-result">
      <img id="hafs-img" src="" alt="" />
      <div class="links">
        <a id="hafs-img-link" href="#" target="_blank">open image</a>
      </div>
    </div>
  </div>

</div>

<script>
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
    });
  });

  const API_BASE = 'https://cycloweb.onrender.com';

  function val(id) { return document.getElementById(id).value.trim(); }

  function setStatus(prefix, type, msg) {
    const el = document.getElementById(prefix + '-status');
    el.className = 'status ' + type;
    el.textContent = msg;
  }

  function setLoading(prefix, btn) {
    setStatus(prefix, 'loading', 'working...');
    document.getElementById(prefix + '-result').classList.remove('visible');
    btn.disabled = true;
  }

  function setDone(prefix, btn) {
    setStatus(prefix, 'success', 'done.');
    btn.disabled = false;
  }

  function setError(prefix, btn, detail) {
    setStatus(prefix, 'error', detail);
    btn.disabled = false;
  }

  async function callAPI(endpoint, params) {
    const url = new URL(API_BASE + endpoint);
    Object.entries(params).forEach(([k, v]) => { if (v) url.searchParams.set(k, v); });
    const res = await fetch(url);
    if (!res.ok) {
      const body = await res.json().catch(() => ({ detail: res.statusText }));
      throw new Error(body.detail || res.statusText);
    }
    return res.json();
  }

  async function runPlot() {
    const btn = event.target;
    setLoading('plot', btn);
    try {
      const data = await callAPI('/plot', {
        satellite: val('plot-satellite'),
        date:      val('plot-date'),
        time:      val('plot-time'),
        lat:       val('plot-lat'),
        lon:       val('plot-lon'),
        band:      val('plot-band'),
        cmap:      val('plot-cmap'),
        zoom:      val('plot-zoom'),
      });
      const imgUrl = API_BASE + data.image_url + '?t=' + Date.now();
      document.getElementById('plot-img').src = imgUrl;
      document.getElementById('plot-img-link').href = imgUrl;
      document.getElementById('plot-nc-link').href = API_BASE + data.nc_url;
      document.getElementById('plot-result').classList.add('visible');
      setDone('plot', btn);
    } catch (e) { setError('plot', btn, e.message); }
  }

  async function runMcfetch() {
    const btn = event.target;
    setLoading('mc', btn);
    try {
      const data = await callAPI('/mcfetch', {
        satellite: val('mc-satellite'),
        date:      val('mc-date'),
        time:      val('mc-time'),
        lat:       val('mc-lat'),
        lon:       val('mc-lon'),
        band:      val('mc-band'),
        cmap:      val('mc-cmap'),
        zoom:      val('mc-zoom'),
      });
      const imgUrl = API_BASE + data.image_url + '?t=' + Date.now();
      document.getElementById('mc-img').src = imgUrl;
      document.getElementById('mc-img-link').href = imgUrl;
      document.getElementById('mc-nc-link').href = API_BASE + data.nc_url;
      document.getElementById('mc-result').classList.add('visible');
      setDone('mc', btn);
    } catch (e) { setError('mc', btn, e.message); }
  }

  async function runHafs() {
    const btn = event.target;
    setLoading('hafs', btn);
    try {
      const data = await callAPI('/hafs', {
        storm:  val('hafs-storm'),
        date:   val('hafs-date'),
        init:   val('hafs-init'),
        fhour:  val('hafs-fhour'),
        var:    val('hafs-var'),
        level:  val('hafs-level'),
        model:  val('hafs-model'),
        domain: val('hafs-domain'),
      });
      const imgUrl = API_BASE + data.image_url + '?t=' + Date.now();
      document.getElementById('hafs-img').src = imgUrl;
      document.getElementById('hafs-img-link').href = imgUrl;
      document.getElementById('hafs-result').classList.add('visible');
      setDone('hafs', btn);
    } catch (e) { setError('hafs', btn, e.message); }
  }
</script>
</body>
</html>
