<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CycloBot</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body { height: 100%; }

    body {
      background: #fff;
      color: #111;
      font-family: 'Courier Prime', 'Courier New', Courier, monospace;
      font-size: 14px;
      display: flex;
      flex-direction: column;
    }

    header {
      border-bottom: 2px solid #111;
      padding: .5rem 1rem;
      display: flex;
      align-items: baseline;
      gap: 1.5rem;
      flex-shrink: 0;
    }
    header h1 { font-size: 14px; font-weight: bold; letter-spacing: .05em; }
    header span { font-size: 11px; color: #555; }

    /* ── Main layout ── */
    .layout {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* ── Left panel: parameters ── */
    .left-panel {
      width: 230px;
      flex-shrink: 0;
      border-right: 1px solid #bbb;
      padding: .9rem .85rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: .6rem;
    }

    .param-panel { display: none; flex-direction: column; gap: .55rem; }
    .param-panel.active { display: flex; }

    .param-title { font-size: 13px; font-weight: bold; }
    .param-desc  { font-size: 11px; color: #666; line-height: 1.4; }

    .field { display: flex; flex-direction: column; gap: .15rem; }
    .field label { font-size: 11px; color: #444; }
    .field input {
      background: #fff;
      border: 1px solid #999;
      color: #111;
      font-family: inherit;
      font-size: 13px;
      padding: .25rem .35rem;
      width: 100%;
    }
    .field input:focus { outline: 1px solid #111; }
    .field input.optional { border-style: dashed; }
    .field .hint { font-size: 11px; color: #888; }

    button.submit {
      background: #111;
      border: 1px solid #111;
      color: #fff;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
      padding: .3rem .9rem;
      align-self: flex-start;
      margin-top: .2rem;
    }
    button.submit:disabled { opacity: .4; cursor: not-allowed; }
    button.submit:hover:not(:disabled) { background: #333; }

    .status { font-size: 10px; min-height: .9rem; }
    .status.loading { color: #555; }
    .status.error   { color: #b00; white-space: pre-wrap; }
    .status.success { color: #080; }

    /* ── Right panel: tabs + image ── */
    .right-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .tabs {
      display: flex;
      justify-content: flex-end;
      border-bottom: 1px solid #aaa;
      flex-shrink: 0;
    }
    .tab-btn {
      background: none;
      border: 1px solid transparent;
      border-bottom: none;
      color: #666;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
      padding: .3rem .85rem;
      margin-bottom: -1px;
    }
    .tab-btn:hover { color: #111; }
    .tab-btn.active {
      color: #111;
      border-color: #aaa;
      border-bottom-color: #fff;
      background: #fff;
    }

    /* ── Image area ── */
    .image-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      overflow: auto;
    }

    .image-area img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: none;
      border: 0px solid #ddd;
    }
    .image-area img.visible { display: block; }

    .image-links {
      display: none;
      gap: 1rem;
      margin-top: .4rem;
      font-size: 11px;
    }
    .image-links.visible { display: flex; }
    .image-links a { color: #111; text-decoration: underline; }

    .image-placeholder {
      font-size: 11px;
      color: #bbb;
    }

    /* ── View toggle (output | ref) ── */
    .view-toggle {
      display: flex;
      justify-content: flex-end;
      border-top: 1px solid #aaa;
      flex-shrink: 0;
    }
    .view-btn {
      background: none;
      border: 1px solid transparent;
      border-top: none;
      color: #666;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
      padding: .3rem .85rem;
      margin-top: -1px;
    }
    .view-btn:hover { color: #111; }
    .view-btn.active {
      color: #111;
      border-color: #aaa;
      border-top-color: #fff;
      background: #fff;
    }

    /* ── Reference area ── */
    .ref-area {
      flex: 1;
      overflow-y: auto;
      padding: .8rem 1rem;
      display: none;
    }
    .ref-area.visible { display: block; }

    .ref-panel { display: none; }
    .ref-panel.active { display: block; }

    .ref-cols {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0 1.5rem;
    }

    .ref-section { margin-bottom: 1rem; }
    .ref-section h3 {
      font-size: 10px;
      font-weight: bold;
      letter-spacing: .08em;
      color: #666;
      border-bottom: 1px solid #ddd;
      padding-bottom: .2rem;
      margin-bottom: .4rem;
    }

    .ref-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }
    .ref-table td {
      padding: .12rem .3rem;
      vertical-align: top;
    }
    .ref-table td.code {
      font-weight: bold;
      white-space: nowrap;
      color: #111;
      width: 6em;
    }
    .ref-table td.note { color: #666; }
    .ref-table tr:nth-child(even) td { background: #f8f8f8; }

    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: .2rem .35rem;
      font-size: 11px;
    }
    .tag-list span {
      background: #f4f4f4;
      border: 1px solid #ddd;
      padding: .05rem .3rem;
    }

    /* ── A-Deck consensus table ── */
    .adeck-table-wrap {
      display: none;
      margin-top: .6rem;
      width: 100%;
      overflow-x: auto;
    }
    .adeck-table-wrap.visible { display: block; }
    .adeck-table {
      width: auto;
      border-collapse: collapse;
      font-size: 11px;
      margin: 0 auto;
    }
    .adeck-table th {
      border-bottom: 1px solid #aaa;
      padding: .2rem .8rem;
      text-align: center;
      font-weight: bold;
      color: #555;
      letter-spacing: .05em;
      font-size: 10px;
    }
    .adeck-table td {
      padding: .15rem .8rem;
      text-align: center;
    }
    .adeck-table tr:nth-child(even) td { background: #f8f8f8; }

    /* ── Mobile ── */
    @media (max-width: 640px) {
      .layout { flex-direction: column; }

      .left-panel {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #bbb;
        max-height: 45vh;
        overflow-y: auto;
      }

      .right-panel { flex: 1; min-height: 0; }

      .tabs { justify-content: flex-start; flex-wrap: wrap; }


      .ref-cols { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<header>
  <h1>CYCLOBOT</h1>
  <span>Satellite Imagery &amp; Model Diagnostics / Deelan Jariwala</span>
</header>

<div class="layout">

  <!-- ── Left: parameter forms ── -->
  <div class="left-panel">

    <div class="param-panel active" id="params-plot">
      <div class="param-title">GOES / Himawari</div>
      <div class="param-desc">GOES-R (16/18/19) and Himawari (8/9) via AWS.</div>
      <div class="field">
        <label>SATELLITE</label>
        <input id="plot-satellite" type="text" placeholder="16, 18, H9" />
        <span class="hint">16 18 19 H8 H9</span>
      </div>
      <div class="field">
        <label>DATE</label>
        <input id="plot-date" type="text" placeholder="MM/DD/YYYY" />
      </div>
      <div class="field">
        <label>TIME (UTC)</label>
        <input id="plot-time" type="text" placeholder="1800" maxlength="4" />
      </div>
      <div class="field">
        <label>LAT</label>
        <input id="plot-lat" type="text" placeholder="25.0" />
      </div>
      <div class="field">
        <label>LON</label>
        <input id="plot-lon" type="text" placeholder="-80.0" />
      </div>
      <div class="field">
        <label>BAND</label>
        <input id="plot-band" type="text" placeholder="13" />
        <span class="hint">channel number</span>
      </div>
      <div class="field">
        <label>COLORMAP</label>
        <input id="plot-cmap" type="text" placeholder="irg" class="optional" />
        <span class="hint">optional</span>
      </div>
      <div class="field">
        <label>ZOOM</label>
        <input id="plot-zoom" type="text" placeholder="2" class="optional" />
        <span class="hint">optional</span>
      </div>
      <button class="submit" onclick="runPlot()">run</button>
      <div class="status" id="plot-status"></div>
    </div>

    <div class="param-panel" id="params-mcfetch">
      <div class="param-title">McIDAS</div>
      <div class="param-desc">Older geostationary archive via SSEC. Covers GOES 1–15, GMS, MTSAT, early Himawari.</div>
      <div class="field">
        <label>SATELLITE</label>
        <input id="mc-satellite" type="text" placeholder="G8, G12, 8" />
      </div>
      <div class="field">
        <label>DATE</label>
        <input id="mc-date" type="text" placeholder="MM/DD/YYYY" />
      </div>
      <div class="field">
        <label>TIME (UTC)</label>
        <input id="mc-time" type="text" placeholder="1800" maxlength="4" />
      </div>
      <div class="field">
        <label>LAT</label>
        <input id="mc-lat" type="text" placeholder="25.0" />
      </div>
      <div class="field">
        <label>LON</label>
        <input id="mc-lon" type="text" placeholder="-80.0" />
      </div>
      <div class="field">
        <label>BAND</label>
        <input id="mc-band" type="text" placeholder="4" />
        <span class="hint">3=WV  4=IR</span>
      </div>
      <div class="field">
        <label>COLORMAP</label>
        <input id="mc-cmap" type="text" placeholder="irg" class="optional" />
        <span class="hint">optional</span>
      </div>
      <div class="field">
        <label>ZOOM (max 2)</label>
        <input id="mc-zoom" type="text" placeholder="2" class="optional" />
        <span class="hint">optional</span>
      </div>
      <button class="submit" onclick="runMcfetch()">run</button>
      <div class="status" id="mc-status"></div>
    </div>

    <div class="param-panel" id="params-hafs">
      <div class="param-title">HAFS</div>
      <div class="param-desc">Hurricane Analysis and Forecast System (HAFS-A/B) real-time output.</div>
      <div class="field">
        <label>STORM</label>
        <input id="hafs-storm" type="text" placeholder="09l" />
        <span class="hint">NNX format</span>
      </div>
      <div class="field">
        <label>INIT DATE</label>
        <input id="hafs-date" type="text" placeholder="MM/DD/YYYY" />
      </div>
      <div class="field">
        <label>INIT HOUR (UTC)</label>
        <input id="hafs-init" type="text" placeholder="12" maxlength="2" />
        <span class="hint">00 06 12 18</span>
      </div>
      <div class="field">
        <label>FCST HOUR</label>
        <input id="hafs-fhour" type="text" placeholder="024" maxlength="3" />
        <span class="hint">e.g. 024 048</span>
      </div>
      <div class="field">
        <label>VARIABLE</label>
        <input id="hafs-var" type="text" placeholder="diseq" />
        <span class="hint">temp wind rh vort pwat cape sst slp shear…</span>
      </div>
      <div class="field">
        <label>LEVEL (hPa)</label>
        <input id="hafs-level" type="text" placeholder="850" class="optional" />
        <span class="hint">optional</span>
      </div>
      <div class="field">
        <label>MODEL</label>
        <input id="hafs-model" type="text" placeholder="a" maxlength="1" class="optional" />
        <span class="hint">a or b</span>
      </div>
      <div class="field">
        <label>DOMAIN</label>
        <input id="hafs-domain" type="text" placeholder="storm" class="optional" />
        <span class="hint">storm or synoptic</span>
      </div>
      <button class="submit" onclick="runHafs()">run</button>
      <div class="status" id="hafs-status"></div>
    </div>

    <div class="param-panel" id="params-tcprimed">
      <div class="param-title">TC-PRIMED</div>
      <div class="param-desc">Passive microwave + IR two-panel from the TC-PRIMED archive.</div>
      <div class="field">
        <label>STORM</label>
        <input id="tc-storm" type="text" placeholder="AL11" />
        <span class="hint">xxXX format, e.g. AL11 EP20 IO06</span>
      </div>
      <div class="field">
        <label>SATELLITE</label>
        <input id="tc-satellite" type="text" placeholder="AMSR" />
        <span class="hint">ATMS AMSR GMI SSMI SSMIS MHS TMI</span>
      </div>
      <div class="field">
        <label>DATE</label>
        <input id="tc-date" type="text" placeholder="MM/DD/YYYY" />
      </div>
      <div class="field">
        <label>TIME (UTC)</label>
        <input id="tc-time" type="text" placeholder="1800" maxlength="4" />
      </div>
      <div class="field">
        <label>CHANNEL</label>
        <input id="tc-datatype" type="text" placeholder="mid" class="optional" />
        <span class="hint">mid (85-91 GHz) or low (36-37 GHz)</span>
      </div>
      <div class="field">
        <label>COLOR RGB</label>
        <input id="tc-color" type="text" placeholder="false" class="optional" />
        <span class="hint">true or false</span>
      </div>
      <button class="submit" onclick="runTcprimed()">run</button>
      <div class="status" id="tc-status"></div>
    </div>

    <div class="param-panel" id="params-adeck">
      <div class="param-title">A-Deck Consensus</div>
      <div class="param-desc">Averaged A-Deck guidance with SST overlay for current-year storms.</div>
      <div class="field">
        <label>STORM</label>
        <input id="ad-storm" type="text" placeholder="al10" />
        <span class="hint">ATCF ID, e.g. al10 ep03 wp05</span>
      </div>
      <div class="field">
        <label>DATE</label>
        <input id="ad-date" type="text" placeholder="MM/DD/YYYY" />
      </div>
      <div class="field">
        <label>INIT HOUR (UTC)</label>
        <input id="ad-time" type="text" placeholder="06" maxlength="2" />
        <span class="hint">00 06 12 18</span>
      </div>
      <div class="field">
        <label>MODELS</label>
        <input id="ad-models" type="text" placeholder="hfai,hfbi,hwrf" />
        <span class="hint">comma-separated ATCF model IDs</span>
      </div>
      <button class="submit" onclick="runAdeck()">run</button>
      <div class="status" id="ad-status"></div>
    </div>

    <div class="param-panel" id="params-shipsri">
      <div class="param-title">SHIPS RI</div>
      <div class="param-desc">Random-forest 24h intensity prediction from SHIPS predictors.</div>
      <div class="field">
        <label>STORM</label>
        <input id="sh-storm" type="text" placeholder="al13" />
        <span class="hint">ATCF ID, e.g. al13 ep05</span>
      </div>
      <div class="field">
        <label>YEAR</label>
        <input id="sh-year" type="text" placeholder="2025" maxlength="4" />
      </div>
      <div class="field">
        <label>MONTH</label>
        <input id="sh-month" type="text" placeholder="10" maxlength="2" />
      </div>
      <div class="field">
        <label>DAY</label>
        <input id="sh-day" type="text" placeholder="24" maxlength="2" />
      </div>
      <div class="field">
        <label>HOUR (UTC)</label>
        <input id="sh-hour" type="text" placeholder="12" maxlength="2" class="optional" />
        <span class="hint">00 06 12 18 — optional, tries all</span>
      </div>
      <button class="submit" onclick="runShipsri()">run</button>
      <div class="status" id="sh-status"></div>
    </div>


    <div class="param-panel" id="params-hrrr">
      <div class="param-title">HRRR</div>
      <div class="param-desc">High-Resolution Rapid Refresh model from AWS.</div>
      <div class="field">
        <label>REGION</label>
        <input id="hr-region" type="text" placeholder="GOM" />
        <span class="hint">GOM SE NE MA SC MW GP SW NW US EUS WUS</span>
      </div>
      <div class="field">
        <label>DATE</label>
        <input id="hr-date" type="text" placeholder="MM/DD/YYYY" />
      </div>
      <div class="field">
        <label>INIT HOUR (UTC)</label>
        <input id="hr-init" type="text" placeholder="18" maxlength="2" />
        <span class="hint">00–23</span>
      </div>
      <div class="field">
        <label>FCST HOUR</label>
        <input id="hr-fhour" type="text" placeholder="06" maxlength="2" />
        <span class="hint">00–48</span>
      </div>
      <div class="field">
        <label>VARIABLE</label>
        <input id="hr-var" type="text" placeholder="temp" />
        <span class="hint">temp wind rh vort pwat cape sst slp shear prcp…</span>
      </div>
      <div class="field">
        <label>LEVEL</label>
        <input id="hr-level" type="text" placeholder="850" class="optional" />
        <span class="hint">hPa or lower/upper/mid/deep — optional</span>
      </div>
      <div class="field">
        <label>DOMAIN</label>
        <input id="hr-domain" type="text" placeholder="conus" class="optional" />
        <span class="hint">conus or alaska — optional</span>
      </div>
      <button class="submit" onclick="runHrrr()">run</button>
      <div class="status" id="hr-status"></div>
    </div>

  </div><!-- /left-panel -->

  <!-- ── Right: tabs + image ── -->
  <div class="right-panel">
    <div class="tabs">
      <button class="tab-btn active" data-tab="plot">GOES / Himawari</button>
      <button class="tab-btn"        data-tab="mcfetch">McIDAS</button>
      <button class="tab-btn"        data-tab="hafs">HAFS</button>
      <button class="tab-btn"        data-tab="tcprimed">TC-PRIMED</button>
      <button class="tab-btn"        data-tab="adeck">A-Deck</button>
      <button class="tab-btn"        data-tab="shipsri">SHIPS RI</button>
      <button class="tab-btn"        data-tab="hrrr">HRRR</button>
    </div>
    <div class="image-area" id="view-output">
      <span class="image-placeholder" id="img-placeholder">output will appear here</span>
      <img id="result-img" src="" alt="" />
      <div class="adeck-table-wrap" id="adeck-table-wrap">
        <table class="adeck-table">
          <thead>
            <tr><th>HOUR</th><th>LAT</th><th>LON</th><th>WIND (kt)</th></tr>
          </thead>
          <tbody id="adeck-table-body"></tbody>
        </table>
      </div>
      <div class="image-links" id="result-links">
        <a id="link-img"  href="#" target="_blank">open image</a>
        <a id="link-extra" href="#" target="_blank" style="display:none"></a>
      </div>
    </div>

    <!-- ── Reference area ── -->
    <div class="ref-area" id="view-ref">

      <!-- Satellite reference (GOES / Himawari / McIDAS) -->
      <div class="ref-panel active" id="ref-satellite">
        <div class="ref-cols">

          <div>
            <div class="ref-section">
              <h3>BASIN REGIONS</h3>
              <table class="ref-table">
                <tr><td class="code">NATL</td><td class="note">North Atlantic</td></tr>
                <tr><td class="code">TATL</td><td class="note">Tropical Atlantic</td></tr>
                <tr><td class="code">WATL</td><td class="note">Western Atlantic</td></tr>
                <tr><td class="code">CATL</td><td class="note">Central Atlantic</td></tr>
                <tr><td class="code">EATL</td><td class="note">Eastern Atlantic</td></tr>
                <tr><td class="code">MDR</td><td class="note">Main Dev. Region</td></tr>
                <tr><td class="code">CV</td><td class="note">Cape Verde</td></tr>
                <tr><td class="code">GOM</td><td class="note">Gulf of Mexico</td></tr>
                <tr><td class="code">EPAC</td><td class="note">Eastern Pacific</td></tr>
                <tr><td class="code">CPAC</td><td class="note">Central Pacific</td></tr>
                <tr><td class="code">WPAC</td><td class="note">Western Pacific</td></tr>
                <tr><td class="code">IO</td><td class="note">Indian Ocean</td></tr>
                <tr><td class="code">BOB</td><td class="note">Bay of Bengal</td></tr>
                <tr><td class="code">ARB</td><td class="note">Arabian Sea</td></tr>
                <tr><td class="code">SWIO</td><td class="note">SW Indian Ocean</td></tr>
                <tr><td class="code">SEIO</td><td class="note">SE Indian Ocean</td></tr>
              </table>
            </div>
            <div class="ref-section">
              <h3>US REGIONS</h3>
              <table class="ref-table">
                <tr><td class="code">NE</td><td class="note">Northeast</td></tr>
                <tr><td class="code">MA</td><td class="note">Mid-Atlantic</td></tr>
                <tr><td class="code">SE</td><td class="note">Southeast</td></tr>
                <tr><td class="code">SC</td><td class="note">South Central</td></tr>
                <tr><td class="code">MW</td><td class="note">Midwest</td></tr>
                <tr><td class="code">GP</td><td class="note">Great Plains</td></tr>
                <tr><td class="code">SW</td><td class="note">Southwest</td></tr>
                <tr><td class="code">NW</td><td class="note">Northwest</td></tr>
              </table>
            </div>
          </div>

          <div>
            <div class="ref-section">
              <h3>IR COLORMAPS</h3>
              <div class="tag-list">
                <span>gs</span><span>avn</span><span>funktop</span><span>jsl</span><span>rainbow</span><span>rainbow2</span><span>rbtop</span><span>rbtop2</span><span>rbtop2.5</span><span>rbtop3</span><span>rbtop4</span><span>rbtop5</span><span>bd</span><span>bd.5</span><span>bd2</span><span>bd3</span><span>bd4</span><span>bd5</span><span>rbbd</span><span>ibtracs</span><span>ibtracs2</span><span>ibtracs3</span><span>rammb</span><span>nhc</span><span>wu</span><span>shrek</span><span>hand</span><span>ryglicki</span><span>candy</span><span>bl</span><span>blcold</span><span>spooky</span><span>lava</span><span>ice</span><span>icy</span><span>ice2</span><span>santa</span><span>gay</span><span>cu</span><span>oldcody</span><span>cody</span><span>icecream</span><span>asir</span><span>volcano</span><span>blob</span><span>whaticouldvedone</span><span>msfcir1</span><span>codyir</span><span>cmyk</span><span>chatgpt</span><span>chatgpt2</span><span>chatgpt3</span><span>chatgpt4</span><span>o2</span><span>mean</span><span>wind</span><span>wind2</span><span>icup</span><span>cloudy</span><span>cs</span><span>ncdc</span><span>ref</span><span>irca</span><span>ir</span><span>ira</span><span>irb</span><span>irc</span><span>ird</span><span>ire</span><span>irf</span><span>irg</span><span>oldirg</span><span>irh</span><span>iri</span><span>irj</span><span>irk</span><span>irl</span><span>irm</span><span>irn</span><span>iro</span><span>irp</span><span>irq</span><span>irr</span><span>irs</span><span>irt</span><span>iru</span><span>irv</span><span>irw</span><span>irx</span><span>iry</span><span>irz</span><span>ir1</span><span>ir2</span><span>ir3</span><span>ir4</span><span>ir5</span><span>ir6</span><span>ir7</span><span>ir8</span><span>ir9</span><span>ir10</span><span>ir11</span><span>ir12</span><span>ir13</span><span>ir14</span><span>ir15</span><span>ir16</span><span>ir17</span><span>ir18</span><span>ir19</span><span>ir20</span><span>ir21</span><span>ir22</span><span>ir23</span><span>ir24</span><span>ir25</span><span>ir26</span><span>ir27</span><span>ir28</span><span>ir29</span><span>ir30</span><span>ir31</span>
              </div>
            </div>

            <div class="ref-section">
              <h3>WV COLORMAPS</h3>
              <div class="tag-list">
                <span>msfc</span><span>psu</span><span>wv</span><span>wv2</span><span>wv3</span><span>wv4</span><span>wv5</span><span>wv6</span><span>wv7</span><span>wv8</span><span>wv9</span><span>wv9.5</span><span>wv10</span><span>wv11</span><span>wv12</span><span>wv13</span><span>wv13.5</span><span>wv14</span><span>wv15</span><span>wv16</span><span>wv17</span><span>wv18</span><span>wv19</span><span>wv20</span><span>wv21</span><span>wv22</span><span>wv23</span><span>wv24</span><span>wv25</span><span>wv26</span><span>wv27</span><span>wv28</span><span>wv29</span><span>wv30</span><span>wv31</span><span>wv32</span><span>wv33</span><span>ghost</span><span>wv34</span><span>wv35</span><span>wv36</span><span>wv37</span><span>wv38</span><span>wv39</span><span>wv39.5</span><span>wv40</span><span>wv41</span><span>wv42</span><span>wv43</span><span>wv44</span><span>wv45</span><span>wv46</span><span>wv47</span><span>wv48</span><span>wv49</span><span>wv50</span><span>wv51</span><span>wv52</span><span>wv53</span><span>uv</span><span>fig</span><span>copper</span><span>bajaflash</span><span>simple</span><span>simple2</span><span>test</span><span>watermelon</span><span>halloween</span><span>irg</span><span>ssd</span><span>mikewv</span><span>codywv</span><span>aswv</span><span>aswvold</span><span>gs</span><span>hand</span><span>dark</span><span>oldwv</span>
              </div>
            </div>
          </div>

        </div>
      </div><!-- /ref-satellite -->

      <!-- HAFS reference -->
      <div class="ref-panel" id="ref-hafs">
        <div class="ref-cols">
          <div>
            <div class="ref-section">
              <h3>LEVEL-REQUIRED VARIABLES</h3>
              <table class="ref-table">
                <tr><td class="code">temp</td><td class="note">Temperature</td></tr>
                <tr><td class="code">dewp</td><td class="note">Dewpoint</td></tr>
                <tr><td class="code">wind</td><td class="note">Wind speed + barbs</td></tr>
                <tr><td class="code">vvel</td><td class="note">Vertical velocity</td></tr>
                <tr><td class="code">rh</td><td class="note">Relative humidity</td></tr>
                <tr><td class="code">vort</td><td class="note">Absolute vorticity (1/s)</td></tr>
                <tr><td class="code">absv</td><td class="note">Absolute vorticity</td></tr>
                <tr><td class="code">hgt</td><td class="note">Geopotential height</td></tr>
                <tr><td class="code">pv</td><td class="note">Potential vorticity</td></tr>
                <tr><td class="code">theta</td><td class="note">Potential temperature</td></tr>
                <tr><td class="code">thetae</td><td class="note">Equiv. potential temperature</td></tr>
                <tr><td class="code">thetae_anom</td><td class="note">Theta-e anomaly</td></tr>
                <tr><td class="code">ci</td><td class="note">Coupling Index (K)</td></tr>
                <tr><td class="code">mss</td><td class="note">Moist Bulk Stability [dThetaE/dZ] (K/m)</td></tr>
                <tr><td class="code">ss</td><td class="note">Bulk Static Stability [dTheta/dZ] (K/m)</td></tr>
                <tr><td class="code">s</td><td class="note">Γd − Γ (C/km)</td></tr>
                <tr><td class="code">ratio</td><td class="note">Reduction Ratio (10m/700mb)</td></tr>
                <tr><td class="code">tadv / tadv_s / tadv_ss</td><td class="note">Temperature advection</td></tr>
                <tr><td class="code">mfc / mfc_s / mfc_ss</td><td class="note">Moisture flux convergence</td></tr>
                <tr><td class="code">div / div_s / div_ss</td><td class="note">Divergence</td></tr>
                <tr><td class="code">mflx / mflx_s / mflx_ss</td><td class="note">Vertical Mass Flux (kg/m²s)</td></tr>
                <tr><td class="code">tfp / tfp_s / tfp_ss</td><td class="note">Thermal Front Parameter (K/m²)</td></tr>
                <tr><td class="code">twp / twp_s / twp_ss</td><td class="note">Thermal Wind CPS Approximation (m/s)</td></tr>
                <tr><td class="code">thg / thg_s / thg_ss</td><td class="note">Thickness Gradient (dimensionless)</td></tr>
                <tr><td class="code">okw / okw_s / okw_ss</td><td class="note">Okubo-Weiss</td></tr>
                <tr><td class="code">fgn / fgn_s / fgn_ss</td><td class="note">Frontogenesis</td></tr>
                <tr><td class="code">diab / diab_s / diab_ss</td><td class="note">Apparent Heat Source (K/hr)</td></tr>
                <tr><td class="code">thadv / thadv_s / thadv_ss</td><td class="note">Theta advection</td></tr>
                <tr><td class="code">thedv / thedv_s / thedv_ss</td><td class="note">Theta-e advection</td></tr>
              </table>
            </div>
          </div>
          <div>
            <div class="ref-section">
              <h3>SURFACE / INTEGRATED VARIABLES</h3>
              <table class="ref-table">
                <tr><td class="code">pwat</td><td class="note">Precipitable water</td></tr>
                <tr><td class="code">cape</td><td class="note">CAPE</td></tr>
                <tr><td class="code">cinh</td><td class="note">CIN</td></tr>
                <tr><td class="code">sst</td><td class="note">Sea surface temperature</td></tr>
                <tr><td class="code">gust</td><td class="note">Wind gusts</td></tr>
                <tr><td class="code">slp</td><td class="note">Sea level pressure</td></tr>
                <tr><td class="code">srh</td><td class="note">Storm-relative helicity</td></tr>
                <tr><td class="code">eff</td><td class="note">Carnot Efficiency (%)</td></tr>
                <tr><td class="code">diseq</td><td class="note">Thermodynamic Disequilibrium (J/kg)</td></tr>
                <tr><td class="code">mpi / mpi_s</td><td class="note">Maximum Potential Intensity (kt)</td></tr>
                <tr><td class="code">vpr</td><td class="note">Ventilation Proxy (dimensionless)</td></tr>
                <tr><td class="code">chim</td><td class="note">Entropy Deficit (dimensionless)</td></tr>
                <tr><td class="code">vi</td><td class="note">Ventilation Index (dimensionless)</td></tr>
                <tr><td class="code">lhf</td><td class="note">Latent heat flux</td></tr>
                <tr><td class="code">shf</td><td class="note">Sensible heat flux</td></tr>
                <tr><td class="code">tdiff</td><td class="note">SST − T2m (K)</td></tr>
                <tr><td class="code">qdiff</td><td class="note">Saturation Deficit (kg/kg)</td></tr>
                <tr><td class="code">nqdiff</td><td class="note">Normalized Saturation Deficit</td></tr>
                <tr><td class="code">mse</td><td class="note">Moist Static Energy (J/kg)</td></tr>
                <tr><td class="code">vmse</td><td class="note">MSE Advection (W/m²)</td></tr>
                <tr><td class="code">shear</td><td class="note">Wind shear (level: upper/mid/deep)</td></tr>
                <tr><td class="code">ref</td><td class="note">Reflectivity (dBz)</td></tr>
              </table>
            </div>
            <div class="ref-section">
              <h3>NOTES</h3>
              <table class="ref-table">
                <tr><td class="code">storm</td><td class="note">NNX format — e.g. 09l, 01e, 02w</td></tr>
                <tr><td class="code">init</td><td class="note">00 / 06 / 12 / 18</td></tr>
                <tr><td class="code">fhour</td><td class="note">e.g. 024, 048, 120</td></tr>
                <tr><td class="code">model</td><td class="note">a (default) or b</td></tr>
                <tr><td class="code">domain</td><td class="note">storm (default) or synoptic</td></tr>
                <tr><td class="code">level</td><td class="note">hPa — e.g. 850, 500, 200</td></tr>
                <tr><td class="code">_s suffix</td><td class="note">smooth once</td></tr>
                <tr><td class="code">_ss suffix</td><td class="note">smooth twice</td></tr>
              </table>
            </div>
          </div>
        </div>
      </div><!-- /ref-hafs -->

      <!-- TC-PRIMED reference -->
      <div class="ref-panel" id="ref-tcprimed">
        <div class="ref-cols">
          <div class="ref-section">
            <h3>SENSORS</h3>
            <table class="ref-table">
              <tr><td class="code">ATMS</td><td class="note">Advanced Technology Microwave Sounder (mid + low)</td></tr>
              <tr><td class="code">AMSR</td><td class="note">Advanced Microwave Scanning Radiometer (mid + low)</td></tr>
              <tr><td class="code">GMI</td><td class="note">GPM Microwave Imager (mid + low)</td></tr>
              <tr><td class="code">SSMI</td><td class="note">Special Sensor Microwave/Imager (mid + low)</td></tr>
              <tr><td class="code">SSMIS</td><td class="note">SSMI/Sounder (mid + low)</td></tr>
              <tr><td class="code">MHS</td><td class="note">Microwave Humidity Sounder (mid only)</td></tr>
              <tr><td class="code">TMI</td><td class="note">TRMM Microwave Imager (mid + low)</td></tr>
            </table>
          </div>
          <div class="ref-section">
            <h3>PARAMETERS</h3>
            <table class="ref-table">
              <tr><td class="code">storm</td><td class="note">xxXX — basin + number, e.g. AL11, EP20, IO06, WP03</td></tr>
              <tr><td class="code">date</td><td class="note">MM/DD/YYYY of the overpass</td></tr>
              <tr><td class="code">time</td><td class="note">Nearest overpass time is selected automatically</td></tr>
              <tr><td class="code">mid</td><td class="note">85–91 GHz channel (deep convection signal)</td></tr>
              <tr><td class="code">low</td><td class="note">36–37 GHz channel (liquid water signal); MHS not supported</td></tr>
              <tr><td class="code">color</td><td class="note">true = RGB composite from H/V polarization ratio</td></tr>
            </table>
          </div>
        </div>
      </div><!-- /ref-tcprimed -->

      <!-- A-Deck reference -->
      <div class="ref-panel" id="ref-adeck">
        <div class="ref-cols">
          <div>
            <div class="ref-section">
              <h3>PARAMETERS</h3>
              <table class="ref-table">
                <tr><td class="code">storm</td><td class="note">ATCF ID — e.g. al10, ep03, wp05</td></tr>
                <tr><td class="code">date</td><td class="note">MM/DD/YYYY of initialization</td></tr>
                <tr><td class="code">time</td><td class="note">Synoptic hour — 00, 06, 12, 18</td></tr>
                <tr><td class="code">models</td><td class="note">Comma-separated ATCF model IDs</td></tr>
              </table>
            </div>
          </div>
          <div>
            <div class="ref-section">
              <h3>COMMON MODELS</h3>
              <table class="ref-table">
                <tr><td class="code">OFCI</td><td class="note">Official NHC forecast</td></tr>
                <tr><td class="code">HFAI / HFBI</td><td class="note">HAFS-A / HAFS-B (interpolated)</td></tr>
                <tr><td class="code">HWFI</td><td class="note">HWRF (interpolated)</td></tr>
                <tr><td class="code">EMXI</td><td class="note">ECMWF (interpolated)</td></tr>
                <tr><td class="code">AVNI</td><td class="note">GFS (interpolated)</td></tr>
                <tr><td class="code">NAMI</td><td class="note">NAM (interpolated)</td></tr>
                <tr><td class="code">CTCI</td><td class="note">CTCX consensus (interpolated)</td></tr>
                <tr><td class="code">ICON</td><td class="note">ICON model</td></tr>
                <tr><td class="code">UKX</td><td class="note">UK Met Office</td></tr>
              </table>
            </div>
          </div>
        </div>
      </div><!-- /ref-adeck -->

      <!-- SHIPS RI reference -->
      <div class="ref-panel" id="ref-shipsri">
        <div class="ref-cols">
          <div>
            <div class="ref-section">
              <h3>PARAMETERS</h3>
              <table class="ref-table">
                <tr><td class="code">storm</td><td class="note">ATCF ID — e.g. al13, ep05</td></tr>
                <tr><td class="code">year</td><td class="note">4-digit year</td></tr>
                <tr><td class="code">month</td><td class="note">Month number (1–12)</td></tr>
                <tr><td class="code">day</td><td class="note">Day number (1–31)</td></tr>
                <tr><td class="code">hour</td><td class="note">00, 06, 12, 18 — optional, tries all if omitted</td></tr>
              </table>
            </div>
          </div>
          <div>
            <div class="ref-section">
              <h3>OUTPUT</h3>
              <table class="ref-table">
                <tr><td class="code">Distribution</td><td class="note">Random forest tree predictions histogram</td></tr>
                <tr><td class="code">Prediction</td><td class="note">Ensemble-mean 24h intensity forecast (kt)</td></tr>
                <tr><td class="code">RI prob.</td><td class="note">% of trees predicting ≥30 kt intensification</td></tr>
                <tr><td class="code">Shear arrow</td><td class="note">200–850mb shear magnitude + direction</td></tr>
              </table>
            </div>
          </div>
        </div>
      </div><!-- /ref-shipsri -->

      <!-- HRRR reference -->
      <div class="ref-panel" id="ref-hrrr">
        <div class="ref-cols">
          <div>
            <div class="ref-section">
              <h3>LEVEL-REQUIRED VARIABLES</h3>
              <table class="ref-table">
                <tr><td class="code">temp</td><td class="note">Temperature (C)</td></tr>
                <tr><td class="code">dewp</td><td class="note">Dewpoint 2m (C)</td></tr>
                <tr><td class="code">wind</td><td class="note">Wind speed (kt)</td></tr>
                <tr><td class="code">vvel</td><td class="note">Vertical velocity (m/s)</td></tr>
                <tr><td class="code">rh</td><td class="note">Relative humidity (%)</td></tr>
                <tr><td class="code">vort</td><td class="note">Absolute vorticity (1/s)</td></tr>
                <tr><td class="code">hgt</td><td class="note">Geopotential height (dm)</td></tr>
                <tr><td class="code">pv</td><td class="note">Potential vorticity (PVU)</td></tr>
                <tr><td class="code">theta</td><td class="note">Potential temperature (K)</td></tr>
                <tr><td class="code">thetae</td><td class="note">Equiv. potential temperature (K)</td></tr>
                <tr><td class="code">mss</td><td class="note">Moist bulk stability (K/m)</td></tr>
                <tr><td class="code">ss</td><td class="note">Bulk static stability (K/m)</td></tr>
                <tr><td class="code">s</td><td class="note">Lapse rate stability (C/km)</td></tr>
                <tr><td class="code">ratio</td><td class="note">10m/700mb wind ratio</td></tr>
                <tr><td class="code">mflx / mflx_s / mflx_ss</td><td class="note">Vertical mass flux (kg/m²s)</td></tr>
                <tr><td class="code">tadv / tadv_s / tadv_ss</td><td class="note">Temperature advection (K/hr)</td></tr>
                <tr><td class="code">thadv / thadv_s / thadv_ss</td><td class="note">Theta advection (K/hr)</td></tr>
                <tr><td class="code">thedv / thedv_s / thedv_ss</td><td class="note">Theta-e advection (K/hr)</td></tr>
                <tr><td class="code">mfc / mfc_s / mfc_ss</td><td class="note">Moisture flux convergence</td></tr>
                <tr><td class="code">div / div_s / div_ss</td><td class="note">Divergence (1/s)</td></tr>
                <tr><td class="code">okw / okw_s / okw_ss</td><td class="note">Okubo-Weiss (1/s²)</td></tr>
                <tr><td class="code">fgn / fgn_s / fgn_ss</td><td class="note">Frontogenesis (K/100km/3hr)</td></tr>
                <tr><td class="code">tfp / tfp_s / tfp_ss</td><td class="note">Thermal frontal parameter</td></tr>
                <tr><td class="code">twp / twp_s / twp_ss</td><td class="note">Thermal wind CPS approx (m/s)</td></tr>
                <tr><td class="code">thg / thg_s / thg_ss</td><td class="note">Thickness gradient</td></tr>
                <tr><td class="code">qdiff / nqdiff</td><td class="note">Saturation deficit (kg/kg)</td></tr>
              </table>
            </div>
          </div>
          <div>
            <div class="ref-section">
              <h3>SURFACE / INTEGRATED VARIABLES</h3>
              <table class="ref-table">
                <tr><td class="code">pwat</td><td class="note">Precipitable water (mm)</td></tr>
                <tr><td class="code">cape</td><td class="note">CAPE (J/kg)</td></tr>
                <tr><td class="code">cinh</td><td class="note">CIN (J/kg)</td></tr>
                <tr><td class="code">sst</td><td class="note">Sea surface temperature (C)</td></tr>
                <tr><td class="code">gust</td><td class="note">Wind gusts (kt)</td></tr>
                <tr><td class="code">slp</td><td class="note">Sea level pressure (hPa)</td></tr>
                <tr><td class="code">srh</td><td class="note">0–3km storm-relative helicity</td></tr>
                <tr><td class="code">eff</td><td class="note">Carnot efficiency (%)</td></tr>
                <tr><td class="code">diseq</td><td class="note">Thermodynamic disequilibrium (J/kg)</td></tr>
                <tr><td class="code">mpi</td><td class="note">Max potential intensity (kt)</td></tr>
                <tr><td class="code">vpr</td><td class="note">Ventilation proxy (dimensionless)</td></tr>
                <tr><td class="code">lhf</td><td class="note">Latent heat flux (W/m²)</td></tr>
                <tr><td class="code">shf</td><td class="note">Sensible heat flux (W/m²)</td></tr>
                <tr><td class="code">tdiff</td><td class="note">SST − T2m (K)</td></tr>
                <tr><td class="code">ci</td><td class="note">Coupling index (K)</td></tr>
                <tr><td class="code">shear</td><td class="note">Wind shear — level: upper/mid/deep</td></tr>
                <tr><td class="code">prcp</td><td class="note">Precipitation type (categorical)</td></tr>
                <tr><td class="code">snow</td><td class="note">Snowfall depth (in)</td></tr>
                <tr><td class="code">ref</td><td class="note">1km composite reflectivity (dBz)</td></tr>
              </table>
            </div>
            <div class="ref-section">
              <h3>NOTES</h3>
              <table class="ref-table">
                <tr><td class="code">region</td><td class="note">GOM SE NE MA SC MW GP SW NW US EUS WUS</td></tr>
                <tr><td class="code">init</td><td class="note">2-digit UTC hour, e.g. 18</td></tr>
                <tr><td class="code">fhour</td><td class="note">Forecast hour, e.g. 06</td></tr>
                <tr><td class="code">level</td><td class="note">hPa for upper-air; lower/upper/mid/deep for layer vars</td></tr>
                <tr><td class="code">_s suffix</td><td class="note">Gaussian smooth once (σ=5)</td></tr>
                <tr><td class="code">_ss suffix</td><td class="note">Gaussian smooth twice (σ=15)</td></tr>
              </table>
            </div>
          </div>
        </div>
      </div><!-- /ref-hrrr -->

    </div><!-- /view-ref -->

    <div class="view-toggle">
      <button class="view-btn active" data-view="output">output</button>
      <button class="view-btn" data-view="ref">ref</button>
    </div>

  </div><!-- /right-panel -->

</div><!-- /layout -->

<script>
  // Track active tool
  let activeTab = 'plot';

  // Tab switching
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.param-panel').forEach(p => p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('params-' + btn.dataset.tab).classList.add('active');
      activeTab = btn.dataset.tab;
      // Sync ref panel to active tool
      const refMap = { hafs: 'ref-hafs', tcprimed: 'ref-tcprimed', adeck: 'ref-adeck', shipsri: 'ref-shipsri', hrrr: 'ref-hrrr' };
      const refId = refMap[activeTab] || 'ref-satellite';
      document.querySelectorAll('.ref-panel').forEach(p => p.classList.remove('active'));
      document.getElementById(refId).classList.add('active');
    });
  });

  // View toggle (output / ref)
  const viewOutput = document.getElementById('view-output');
  const viewRef    = document.getElementById('view-ref');
  document.querySelectorAll('.view-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      if (btn.dataset.view === 'ref') {
        viewOutput.style.display = 'none';
        viewRef.classList.add('visible');
      } else {
        viewOutput.style.display = '';
        viewRef.classList.remove('visible');
      }
    });
  });

  const API_BASE = 'https://tcalert-cycloweb.hf.space';

  function val(id) { return document.getElementById(id).value.trim(); }

  function setStatus(prefix, type, msg) {
    const el = document.getElementById(prefix + '-status');
    el.className = 'status ' + type;
    el.textContent = msg;
  }

  function showImage(imgUrl, extraUrl, extraLabel) {
    // Switch to output view when a result arrives
    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
    document.querySelector('.view-btn[data-view="output"]').classList.add('active');
    viewOutput.style.display = '';
    viewRef.classList.remove('visible');
    document.getElementById('img-placeholder').style.display = 'none';
    document.getElementById('adeck-table-wrap').classList.remove('visible');
    const img = document.getElementById('result-img');
    img.src = imgUrl;
    img.classList.add('visible');
    document.getElementById('link-img').href = imgUrl;
    const links = document.getElementById('result-links');
    links.classList.add('visible');
    const extra = document.getElementById('link-extra');
    if (extraUrl) {
      extra.href = extraUrl;
      extra.textContent = extraLabel;
      extra.style.display = '';
    } else {
      extra.style.display = 'none';
    }
  }

  function setLoading(prefix, btn) {
    setStatus(prefix, 'loading', 'working...');
    btn.disabled = true;
  }

  function setDone(prefix, btn) {
    setStatus(prefix, 'success', 'done.');
    btn.disabled = false;
  }

  function setError(prefix, btn, detail) {
    setStatus(prefix, 'error', detail);
    btn.disabled = false;
  }

  async function callAPI(endpoint, params) {
    const url = new URL(API_BASE + endpoint);
    Object.entries(params).forEach(([k, v]) => { if (v) url.searchParams.set(k, v); });
    const res = await fetch(url);
    if (!res.ok) {
      const body = await res.json().catch(() => ({ detail: res.statusText }));
      throw new Error(body.detail || res.statusText);
    }
    return res.json();
  }

  async function runPlot() {
    const btn = event.target;
    setLoading('plot', btn);
    try {
      const data = await callAPI('/plot', {
        satellite: val('plot-satellite'),
        date:      val('plot-date'),
        time:      val('plot-time'),
        lat:       val('plot-lat'),
        lon:       val('plot-lon'),
        band:      val('plot-band'),
        cmap:      val('plot-cmap'),
        zoom:      val('plot-zoom'),
      });
      showImage(API_BASE + data.image_url + '?t=' + Date.now(), API_BASE + data.nc_url, 'download .nc');
      setDone('plot', btn);
    } catch (e) { setError('plot', btn, e.message); }
  }

  async function runMcfetch() {
    const btn = event.target;
    setLoading('mc', btn);
    try {
      const data = await callAPI('/mcfetch', {
        satellite: val('mc-satellite'),
        date:      val('mc-date'),
        time:      val('mc-time'),
        lat:       val('mc-lat'),
        lon:       val('mc-lon'),
        band:      val('mc-band'),
        cmap:      val('mc-cmap'),
        zoom:      val('mc-zoom'),
      });
      showImage(API_BASE + data.image_url + '?t=' + Date.now(), API_BASE + data.nc_url, 'download .nc');
      setDone('mc', btn);
    } catch (e) { setError('mc', btn, e.message); }
  }

  async function runHafs() {
    const btn = event.target;
    setLoading('hafs', btn);
    try {
      const data = await callAPI('/hafs', {
        storm:  val('hafs-storm'),
        date:   val('hafs-date'),
        init:   val('hafs-init'),
        fhour:  val('hafs-fhour'),
        var:    val('hafs-var'),
        level:  val('hafs-level'),
        model:  val('hafs-model'),
        domain: val('hafs-domain'),
      });
      showImage(API_BASE + data.image_url + '?t=' + Date.now(), null, null);
      setDone('hafs', btn);
    } catch (e) { setError('hafs', btn, e.message); }
  }

  async function runTcprimed() {
    const btn = event.target;
    setLoading('tc', btn);
    try {
      const data = await callAPI('/tcprimed', {
        storm:     val('tc-storm'),
        satellite: val('tc-satellite'),
        date:      val('tc-date'),
        time:      val('tc-time'),
        datatype:  val('tc-datatype') || 'mid',
        color:     val('tc-color')    || 'false',
      });
      showImage(API_BASE + data.image_url + '?t=' + Date.now(), null, null);
      setDone('tc', btn);
    } catch (e) { setError('tc', btn, e.message); }
  }

  async function runAdeck() {
    const btn = event.target;
    setLoading('ad', btn);
    try {
      const data = await callAPI('/adeckavg', {
        storm:  val('ad-storm'),
        date:   val('ad-date'),
        time:   val('ad-time'),
        models: val('ad-models'),
      });
      showImage(API_BASE + data.image_url + '?t=' + Date.now(), null, null);
      if (data.table && data.table.length) {
        const tbody = document.getElementById('adeck-table-body');
        tbody.innerHTML = data.table.map(r =>
          `<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td><td>${r[3]}</td></tr>`
        ).join('');
        document.getElementById('adeck-table-wrap').classList.add('visible');
      }
      setDone('ad', btn);
    } catch (e) { setError('ad', btn, e.message); }
  }

  async function runHrrr() {
    const btn = event.target;
    setLoading('hr', btn);
    try {
      const data = await callAPI('/hrrr', {
        region: val('hr-region'),
        date:   val('hr-date'),
        init:   val('hr-init'),
        fhour:  val('hr-fhour'),
        var:    val('hr-var'),
        level:  val('hr-level'),
        domain: val('hr-domain'),
      });
      showImage(API_BASE + data.image_url + '?t=' + Date.now(), null, null);
      setDone('hr', btn);
    } catch (e) { setError('hr', btn, e.message); }
  }

  async function runShipsri() {
    const btn = event.target;
    setLoading('sh', btn);
    try {
      const data = await callAPI('/shipsri', {
        storm: val('sh-storm'),
        year:  val('sh-year'),
        month: val('sh-month'),
        day:   val('sh-day'),
        hour:  val('sh-hour'),
      });
      showImage(API_BASE + data.image_url + '?t=' + Date.now(), null, null);
      setDone('sh', btn);
    } catch (e) { setError('sh', btn, e.message); }
  }

</script>
</body>
</html>
